#!/bin/zsh
# Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)
# Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
plugins=(zsh-autosuggestions vi-mode z)

DEFAULT_USER='jlane'

# Comment this out to disable bi-weekly auto-update checks
DISABLE_AUTO_UPDATE="true"

HISTSIZE=99999999
SAVEHIST=99999999

ZSH_THEME="powerlevel10k/powerlevel10k"
POWERLEVEL9K_MODE='nerdfont-complete'
POWERLEVEL9K_COLOR_SCHEME='dark'
POWERLEVEL9K_HOST_TEMPLATE="%2m"
POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX=""
POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="$ "
POWERLEVEL9K_PROMPT_ON_NEWLINE=true
POWERLEVEL9K_VI_COMMAND_MODE_STRING="î˜«"
POWERLEVEL9K_VI_INSERT_MODE_STRING=""
POWERLEVEL9K_VI_OVERWRITE_MODE_STRING="R"
POWERLEVEL9K_CHRUBY_SHOW_ENGINE=false
POWERLEVEL9K_VI_MODE_INSERT_FOREGROUND="cyan"
POWERLEVEL9K_VI_MODE_NORMAL_FOREGROUND="yellow"
POWERLEVEL9K_VI_MODE_OVERWRITE_FOREGROUND="red"

POWERLEVEL9K_CHRUBY_SHOW_DEFAULT=false

POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND='yellow'
POWERLEVEL9K_VCS_GIT_HOOKS=(vcs-detect-changes git-untracked git-aheadbehind git-tagname)
POWERLEVEL9K_DIR_SHOW_WRITABLE=true
POWERLEVEL9K_CONTEXT_FOREGROUND='yellow'
POWERLEVEL9K_SSH_FOREGROUND='grey'
POWERLEVEL9K_VCS_CLEAN_FOREGROUND='white'
POWERLEVEL9K_VCS_CLEAN_BACKGROUND='grey'
POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND='yellow'
POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND='black'
POWERLEVEL9K_VCS_MODIFIED_FOREGROUND='red'
POWERLEVEL9K_VCS_MODIFIED_BACKGROUND='black'
POWERLEVEL9K_SHORTEN_DIR_LENGTH=1
POWERLEVEL9K_SHORTEN_DELIMITER=""
POWERLEVEL9K_SHORTEN_STRATEGY="truncate_from_right"
POWERLEVEL9K_TRANSIENT_PROMPT='same-dir'
POWERLEVEL9K_STATUS_OK=""

typeset -g POWERLEVEL9K_PROMPT_CHAR_OK_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=cyan
typeset -g POWERLEVEL9K_PROMPT_CHAR_ERROR_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=red
typeset -g POWERLEVEL9K_PROMPT_CHAR_{OK,ERROR}_VIINS_CONTENT_EXPANSION='$'

POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(vi_mode background_jobs_joined context dir vcs status)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(command_execution_time)


ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=cyan,underline"
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=50
ZSH_AUTOSUGGEST_USE_ASYNC=1

setopt inc_append_history
setopt extended_history
setopt hist_find_no_dups
setopt hist_ignore_all_dups
setopt hist_expire_dups_first
setopt hist_ignore_space

unsetopt nomatch
unsetopt share_history
unsetopt correct_all

bindkey -v # vi-mode

bindkey '^P' up-history
bindkey '^N' down-history
bindkey '^?' backward-delete-char
bindkey '^h' backward-delete-char
bindkey '^w' backward-kill-word
bindkey '^r' history-incremental-search-backward
bindkey '^s' history-incremental-search-forward

autoload edit-command-line; zle -N edit-command-line
bindkey -M vicmd v edit-command-line

[[ -r "$HOME/.env" ]] && source "$HOME/.env"
[[ -r "${HOME}/.local/share/z/z.sh" ]] && source "${HOME}/.local/share/z/z.sh"
[[ -r "${HOME}/.config/zsh/fzf.zsh" ]] && source "${HOME}/.config/zsh/fzf.zsh"
[[ -r "${HOME}/.z.zsh" ]] && source "${HOME}/.z.zsh"

# play nice with bash
autoload -U +X bashcompinit && bashcompinit

# keys
export KEYTIMEOUT=1
KEYCHAIN=${SSH_KEYS:-"${HOME}/.ssh/id_rsa"}
if command -v keychain >/dev/null; then
	if [[ $(uname) == 'Linux' ]]; then
		eval $(keychain -q --eval --agents ssh $KEYCHAIN)
	else
		eval $(keychain -q --eval --agents ssh --inherit any $KEYCHAIN)
	fi
	[ -f ~/.keychain/$HOST-sh ] && source ~/.keychain/$HOST-sh
	[ -f ~/.keychain/$HOST-sh-gpg ] && source ~/.keychain/$HOST-sh-gpg
elif [ -f "${HOME}/.ssh/id_rsa" ]; then
	ssh-add -A ~/.ssh/id_rsa &>/dev/null
fi

. "${HOME}/.profile"
. "$HOME/.alias"
. "$HOME/.zshenv"


# prompt
if command -v starship >/dev/null; then
	eval "$(starship init zsh)"
elif [[ -d "$HOME/.oh-my-zsh" ]]; then
	ZSH=$HOME/.oh-my-zsh
	source $ZSH/oh-my-zsh.sh
fi
