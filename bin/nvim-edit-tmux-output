#!/usr/bin/env bash
# Capture current tmux pane content and open in Neovim for easy selection/copying

set -euo pipefail

# Create temp file
tmpfile=$(mktemp /tmp/tmux-pane-output.XXXXXX)

# Capture entire scrollback history of current pane (strip ANSI color codes)
tmux capture-pane -p -S - > "$tmpfile"

# Open in Neovim popup for easy selection
# Use popup instead of new window for less disruption
# Match dimensions of prefix+P popup (no dimensions = tmux default)
tmux popup -E "nvim \
  -c 'set buftype=nofile' \
  -c 'set bufhidden=wipe' \
  -c 'set noswapfile' \
  -c 'set filetype=tmux-output' \
  -c 'nnoremap <buffer> q :q!<CR>' \
  -c 'nnoremap <buffer> <Esc> :q!<CR>' \
  -c 'normal! G' \
  '$tmpfile'; rm -f '$tmpfile'"
